<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>아서앤그레이스 고객관리 시스템</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBWmNRMRRoo5Fv90ZaMiJzyFhQevWhRUes",
            databaseURL: "https://customer-47ac0-default-rtdb.firebaseio.com/",
            projectId: "customer-47ac0"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // Firebase 관련 함수들을 전역으로 노출
        window.firebaseDB = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebaseOnValue = onValue;
        
        // Firebase 초기화 완료 이벤트
        window.dispatchEvent(new Event('firebaseInitialized'));
    </script>
    
    <script>
        // Firebase 데이터 관리 함수들 (영구저장 보장)
        window.FirebaseData = {
            isInitialized: false,
            saveQueue: [], // 저장 대기열
            retryCount: 0,
            maxRetries: 5,
            
            // Firebase 초기화 대기
            async waitForInit() {
                if (this.isInitialized) return;
                
                return new Promise((resolve) => {
                    if (window.firebaseDB) {
                        this.isInitialized = true;
                        resolve();
            } else {
                        window.addEventListener('firebaseInitialized', () => {
                            this.isInitialized = true;
                            resolve();
                        });
                    }
                });
            },
            
            // Firebase에서 데이터 가져오기 (재시도 로직 포함)
            async loadFromFirebase(retryCount = 0) {
                await this.waitForInit();
                
                try {
                    console.log('Firebase에서 데이터 로드 시도...', retryCount + 1);
                    const snapshot = await window.firebaseGet(window.firebaseRef(window.firebaseDB, 'customerData'));
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        console.log('Firebase에서 데이터 로드 성공:', {
                            customers: data.customers?.length || 0,
                            purchases: data.purchases?.length || 0,
                            gifts: data.gifts?.length || 0,
                            visits: data.visits?.length || 0
                        });
                        return data;
                    } else {
                        console.log('Firebase에 저장된 데이터가 없음');
                        return null;
                    }
                } catch (error) {
                    console.error('Firebase 데이터 로드 오류:', error);
                    
                    // 재시도 로직
                    if (retryCount < this.maxRetries) {
                        console.log(`Firebase 로드 재시도 (${retryCount + 1}/${this.maxRetries})`);
                        await new Promise(resolve => setTimeout(resolve, 2000 * (retryCount + 1)));
                        return this.loadFromFirebase(retryCount + 1);
                    }
                    
                    this.showSaveStatus('⚠ 데이터 로드 실패', 'error');
                    return null;
                }
            },
            
            // Firebase에 데이터 저장 (성공 시 재시도 방지)
            async saveToFirebase(data, retryCount = 0) {
                await this.waitForInit();
                
                try {
                    const saveData = {
                        customers: data.customers || [],
                        purchases: data.purchases || [],
                        gifts: data.gifts || [],
                        visits: data.visits || [],
                        rankChanges: data.rankChanges || [],
                        lastUpdated: Date.now(),
                        version: '1.0',
                        savedAt: new Date().toISOString()
                    };
                    
                    console.log('Firebase에 데이터 저장 시도...', {
                        customers: saveData.customers.length,
                        purchases: saveData.purchases.length,
                        attempt: retryCount + 1
                    });
                    
                    await window.firebaseSet(window.firebaseRef(window.firebaseDB, 'customerData'), saveData);
                    
                    // 저장 후 검증
                    const verification = await this.verifyDataSaved(saveData);
                    if (!verification.success) {
                        throw new Error('데이터 저장 검증 실패: ' + verification.error);
                    }
                    
                    console.log('Firebase에 데이터 저장 및 검증 완료');
                    this.showSaveStatus('✓ 저장 완료', 'success', 2000);
                    this.retryCount = 0; // 성공 시 재시도 카운트 리셋
                    
                    // 저장 대기열에서 제거 (성공한 항목만)
                    this.saveQueue = this.saveQueue.filter(item => item.timestamp !== saveData.lastUpdated);
                    
                    // 성공 시 즉시 반환하여 추가 재시도 방지
                    return true;
                } catch (error) {
                    console.error('Firebase 데이터 저장 오류:', error);
                    
                    // 재시도 로직 (실패한 경우에만)
                    if (retryCount < this.maxRetries) {
                        console.log(`Firebase 저장 재시도 (${retryCount + 1}/${this.maxRetries})`);
                        this.showSaveStatus(`🔄 저장 재시도 중 (${retryCount + 1}/${this.maxRetries})`, 'info');
                        
                        // 재시도 전 대기 시간
                        await new Promise(resolve => setTimeout(resolve, 2000 * (retryCount + 1)));
                        
                        // 재귀 호출로 재시도 (대기열 추가하지 않음)
                        return this.saveToFirebase(data, retryCount + 1);
                    }
                    
                    // 최대 재시도 횟수 초과 시
                    this.showSaveStatus('❌ 저장 실패', 'error', 5000);
                    console.error('Firebase 저장 최종 실패:', error);
                    
                    return false;
                }
            },
            
            // 저장된 데이터 검증
            async verifyDataSaved(savedData) {
                try {
                    const snapshot = await window.firebaseGet(window.firebaseRef(window.firebaseDB, 'customerData'));
                    if (!snapshot.exists()) {
                        return { success: false, error: '저장된 데이터를 찾을 수 없음' };
                    }
                    
                    const retrievedData = snapshot.val();
                    
                    // 기본 검증
                    if (retrievedData.lastUpdated !== savedData.lastUpdated) {
                        return { success: false, error: '타임스탬프 불일치' };
                    }
                    
                    if (retrievedData.customers?.length !== savedData.customers?.length) {
                        return { success: false, error: '고객 수 불일치' };
                    }
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            // 대기열 처리 (더 이상 사용하지 않음 - 직접 재시도 방식으로 변경)
            async processQueue() {
                // 저장 성공 시 재시도하지 않도록 대기열 시스템 비활성화
                console.log('대기열 시스템 비활성화됨 - 직접 재시도 방식 사용');
                this.saveQueue = []; // 대기열 초기화
            },
            
            // 데이터 새로고침 (데이터 무결성 보장)
            async forceSyncWithFirebase(showMessage = false) {
                try {
                    // 메시지 표시 여부를 매개변수로 제어
                    if (showMessage) {
                        this.showSaveStatus('🔄 데이터 새로고침 중...', 'info');
                    }
                    
                    // Firebase에서 최신 데이터 가져오기
                    const firebaseData = await this.loadFromFirebase();
                    
                    if (firebaseData) {
                        // 로컬 데이터 업데이트
                        if (window.customers) window.customers.length = 0;
                        if (window.purchases) window.purchases.length = 0;
                        if (window.gifts) window.gifts.length = 0;
                        if (window.visits) window.visits.length = 0;
                        if (window.rankChanges) window.rankChanges.length = 0;
                        
                        if (firebaseData.customers) window.customers.push(...firebaseData.customers);
                        if (firebaseData.purchases) window.purchases.push(...firebaseData.purchases);
                        if (firebaseData.gifts) window.gifts.push(...firebaseData.gifts);
                        if (firebaseData.visits) window.visits.push(...firebaseData.visits);
                        if (firebaseData.rankChanges) window.rankChanges.push(...firebaseData.rankChanges);
                        
                        // 로컬스토리지 업데이트
                        localStorage.setItem('customers', JSON.stringify(window.customers || []));
                        localStorage.setItem('purchases', JSON.stringify(window.purchases || []));
                        localStorage.setItem('gifts', JSON.stringify(window.gifts || []));
                        localStorage.setItem('visits', JSON.stringify(window.visits || []));
                        localStorage.setItem('rankChanges', JSON.stringify(window.rankChanges || []));
                        localStorage.setItem('lastUpdated', firebaseData.lastUpdated?.toString() || Date.now().toString());
                        
                        // UI 새로고침
                        if (typeof loadCustomerList === 'function') loadCustomerList();
                        if (typeof loadBirthdayAlerts === 'function') loadBirthdayAlerts();
                        if (typeof loadRankingCounts === 'function') loadRankingCounts();
                        
                        // 메시지를 표시하는 경우에만 완료 메시지도 표시
                        if (showMessage) {
                            this.showSaveStatus('✅ 데이터 새로고침 완료', 'success');
                        }
                        console.log('Firebase 데이터 새로고침 완료');
                    }
                } catch (error) {
                    console.error('데이터 새로고침 오류:', error);
                    
                    // 네트워크 오류인 경우 다른 메시지 표시
                    if (!navigator.onLine) {
                        this.showSaveStatus('📱 오프라인 모드', 'info', 3000);
                    } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
                        // 네트워크 연결 문제
                        this.showSaveStatus('🌐 연결 확인 중...', 'info', 3000);
                    } else if (error.message && error.message.includes('Firebase')) {
                        // Firebase 초기화 관련 오류는 조용히 처리
                        console.warn('Firebase 초기화 중 오류 (무시됨):', error.message);
                    } else {
                        // 실제 서버 오류인 경우에만 실패 표시
                        console.warn('데이터 새로고침 오류 (무시됨):', error.message);
                    }
                }
            },
            
            // 저장 상태 표시
            showSaveStatus(message, type = 'info', duration = 3000) {
                const statusDiv = document.getElementById('save-status') || this.createSaveStatusDiv();
                statusDiv.className = `save-status ${type}`;
                statusDiv.textContent = message;
                statusDiv.style.display = 'block';
                
                // 상단 버튼 상태도 업데이트
                if (window.updateSyncStatus) {
                    window.updateSyncStatus(type === 'info' ? 'syncing' : type);
                }
                
                if (duration > 0) {
                    setTimeout(() => {
                        statusDiv.style.display = 'none';
                        if (window.updateSyncStatus && type !== 'error') {
                            window.updateSyncStatus();
                        }
                    }, duration);
                }
            },
            
            // 저장 상태 div 생성
            createSaveStatusDiv() {
                const statusDiv = document.createElement('div');
                statusDiv.id = 'save-status';
                statusDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 12px 18px;
                    border-radius: 8px;
                    color: white;
                    font-size: 14px;
                    font-weight: 500;
                    z-index: 9999;
                    display: none;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                    max-width: 300px;
                    word-wrap: break-word;
                `;
                document.body.appendChild(statusDiv);
                return statusDiv;
            }
        };
        
        // 주기적 대기열 처리 및 연결 상태 확인
        setInterval(() => {
            if (window.FirebaseData && navigator.onLine) {
                window.FirebaseData.processQueue();
            }
        }, 30000); // 30초마다
        
        // 페이지 포커스 시 데이터 확인 (5분 이상 지났을 때만) - 메시지 표시 안함
        let lastFocusSync = 0;
        window.addEventListener('focus', () => {
            if (window.FirebaseData && window.FirebaseData.isInitialized && navigator.onLine) {
                const now = Date.now();
                const timeSinceLastSync = now - lastFocusSync;
                
                // 5분(300초) 이상 지났을 때만 새로고침 (메시지 표시 안함)
                if (timeSinceLastSync > 300000) {
                    setTimeout(() => {
                        lastFocusSync = now;
                        window.FirebaseData.forceSyncWithFirebase(false); // 메시지 표시 안함
                    }, 1000);
                }
            }
        });
        
        // 네트워크 상태 변경 감지
        window.addEventListener('online', () => {
            console.log('네트워크 연결됨 - 데이터 새로고침 시작');
            if (window.FirebaseData && window.FirebaseData.isInitialized) {
                setTimeout(() => {
                    window.FirebaseData.forceSyncWithFirebase(false); // 메시지 표시 안함
                    window.FirebaseData.processQueue();
                }, 2000);
            }
        });
        
        window.addEventListener('offline', () => {
            console.log('네트워크 연결 끊김 - 로컬 저장으로 전환');
            if (window.FirebaseData) {
                window.FirebaseData.showSaveStatus('📱 오프라인 모드', 'info', 5000);
            }
        });
        
        // CSS 스타일 추가
        const style = document.createElement('style');
        style.textContent = `
            .save-status {
                transition: all 0.3s ease;
                font-weight: 500;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.15);
                border: none;
            }
            .save-status.success {
                background: linear-gradient(45deg, #28a745, #20c997);
                animation: pulse-success 2s ease-in-out;
            }
            .save-status.error {
                background: linear-gradient(45deg, #dc3545, #fd7e14);
                animation: shake 0.5s ease-in-out;
            }
            .save-status.info {
                background: linear-gradient(45deg, #17a2b8, #6f42c1);
                animation: fade-in 0.3s ease-in-out;
            }
            @keyframes pulse-success {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.05); }
            }
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
            @keyframes fade-in {
                0% { opacity: 0; transform: translateY(-10px); }
                100% { opacity: 1; transform: translateY(0); }
            }
            
            /* 저장 상태 표시기 */
            #sync-status-btn {
                transition: all 0.3s ease;
            }
            #sync-status-btn.syncing {
                animation: spin 1s linear infinite;
                color: #17a2b8 !important;
            }
            #sync-status-btn.success {
                color: #28a745 !important;
            }
            #sync-status-btn.error {
                color: #dc3545 !important;
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
            document.head.appendChild(style);
        
        // 저장 상태 버튼 업데이트
        function updateSyncButton(status) {
            const syncBtn = document.getElementById('sync-status-btn');
            if (syncBtn) {
                syncBtn.className = syncBtn.className.replace(/\b(syncing|success|error)\b/g, '');
                if (status) {
                    syncBtn.classList.add(status);
                }
            }
        }
        
        // 전역 저장 상태 업데이트 함수
        window.updateSyncStatus = updateSyncButton;
        
        // CloudSync 호환성을 위한 더미 객체
        window.CloudSync = {
            startAutoSync: () => console.log('CloudSync 호환성 모드'),
            forceSyncToCloud: () => {
                if (window.FirebaseData) {
                    return window.FirebaseData.forceSyncWithFirebase();
                }
                return Promise.resolve(false);
            }
        };
        window.CLOUD_SYNC = { enabled: true };
    </script>
</head>
<body>
    <div class="container">
        <div id="main-content">
            <!-- 모바일 상단 헤더 -->
            <div class="mobile-header d-lg-none">
                <div class="d-flex justify-content-between align-items-center p-3 bg-light">
                    <button class="btn btn-outline-dark" id="sidebar-toggle">
                        <i class="bi bi-list"></i>
                    </button>
                    <div class="mobile-title" id="mobile-title-home" style="cursor: pointer;">
                        <div class="brand-name">아서앤그레이스</div>
                        <div class="system-name">고객관리시스템</div>
                    </div>
                    <div class="d-flex">
                        <button class="btn btn-outline-info btn-sm me-1" id="sync-status-btn" title="저장 상태">
                            <i class="bi bi-cloud-check"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 사이드바 -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h4>메뉴</h4>
                    <button class="btn btn-sm btn-outline-light d-none" id="sidebar-close">
                        <i class="bi bi-x"></i>
                    </button>
                </div>
                <ul class="sidebar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-page="customer-list">
                            <i class="bi bi-people"></i> 고객 목록
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="add-customer">
                            <i class="bi bi-person-plus"></i> 고객 등록
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="birthday-alerts">
                            <i class="bi bi-calendar-heart"></i> 생일 알림
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="gift-history">
                            <i class="bi bi-gift"></i> 선물 이력
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="customer-ranking">
                            <i class="bi bi-trophy"></i> 고객 등급
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="visit-tracking">
                            <i class="bi bi-calendar-check"></i> 방문 주기
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-danger" href="#" id="reset-database" onclick="if(window.resetDatabase) window.resetDatabase(); return false;">
                            <i class="bi bi-trash3"></i> DB 초기화
                        </a>
                    </li>
                    <li class="nav-item border-top mt-3 pt-3">
                        <a class="nav-link text-warning" href="#" id="logout-btn">
                            <i class="bi bi-box-arrow-right"></i> 로그아웃
                        </a>
                    </li>
                </ul>
            </div>

            <!-- 사이드바 오버레이 (모바일용) -->
            <div class="sidebar-overlay" id="sidebar-overlay"></div>

            <!-- 메인 콘텐츠 영역 -->
            <div class="main-content" id="main-content-area">

            <!-- 고객 목록 페이지 -->
            <div id="customer-list" class="page">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="mb-0">고객 목록</h3>
                    <button class="btn btn-success" id="export-excel-btn">
                        <i class="bi bi-download"></i> 엑셀 다운로드
                    </button>
                </div>
                
                <!-- 검색창 고정 섹션 -->
                <div class="search-section">
                    <div class="row">
                        <div class="col-12">
                            <div class="input-group">
                                <input type="text" class="form-control" id="search-input" placeholder="이름, 전화번호, 매장, 등급, 메모로 검색">
                                <button class="btn btn-primary" id="search-btn">검색</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>이름</th>
                                <th>전화번호</th>
                                <th class="mobile-hide">생년월일</th>
                                <th class="mobile-hide">주방문매장</th>
                                <th>등급</th>
                                <th class="mobile-hide">최근 방문일</th>
                            </tr>
                        </thead>
                        <tbody id="customer-list-body">
                            <!-- 고객 목록이 여기에 동적으로 삽입됩니다 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 모바일 전용 하단 버튼 -->
                <div class="mobile-fixed-bottom d-md-none">
                    <button class="btn btn-success" id="mobile-add-customer-btn">
                        <i class="bi bi-plus-circle"></i> 고객 등록
                    </button>
                </div>
            </div>

            <!-- 고객 등록 페이지 -->
            <div id="add-customer" class="page d-none">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="mb-0">고객 등록</h3>
                    <button class="btn btn-outline-info" id="toggle-excel-upload-btn">
                        <i class="bi bi-file-earmark-excel"></i> 엑셀업로드
                    </button>
                </div>
                
                <!-- 개별 고객 등록 -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">개별 고객 등록</h5>
                    </div>
                    <div class="card-body">
                        <form id="customer-form">
                            <div class="row">
                                <div class="col-12 col-md-6">
                                    <div class="mb-3">
                                        <label for="name" class="form-label">이름 *</label>
                                        <input type="text" class="form-control" id="name" required placeholder="고객 이름을 입력하세요">
                                    </div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <div class="mb-3">
                                        <label for="phone" class="form-label">전화번호 *</label>
                                        <input type="tel" class="form-control" id="phone" required placeholder="전화번호를 입력하세요">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 col-md-6">
                                    <div class="mb-3">
                                        <label for="gender" class="form-label">성별</label>
                                        <select class="form-select" id="gender">
                                            <option value="">선택 안함</option>
                                            <option value="남성">남성</option>
                                            <option value="여성">여성</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <div class="mb-3">
                                        <label for="birth-date" class="form-label">생년월일</label>
                                        <input type="date" class="form-control" id="birth-date">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 col-md-6">
                                    <div class="mb-3">
                                        <label for="address" class="form-label">주소</label>
                                        <input type="text" class="form-control" id="address" placeholder="주소를 입력하세요">
                                    </div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <div class="mb-3">
                                        <label for="main-branch" class="form-label">주방문매장</label>
                                        <input type="text" class="form-control" id="main-branch" placeholder="주방문매장을 입력하세요">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 col-md-6">
                                    <div class="mb-3">
                                        <label for="email" class="form-label">이메일</label>
                                        <input type="email" class="form-control" id="email" placeholder="이메일을 입력하세요">
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label for="memo" class="form-label">메모</label>
                                        <textarea class="form-control" id="memo" rows="3" placeholder="고객 메모를 입력하세요"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-person-plus"></i> 고객 등록
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- 엑셀 업로드 (토글) -->
                <div class="card d-none" id="excel-upload-section">
                    <div class="card-header">
                        <h5 class="mb-0">엑셀 파일 업로드</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="excel-file" class="form-label">엑셀 파일 선택 (.xlsx, .xls)</label>
                            <input class="form-control" type="file" id="excel-file" accept=".xlsx,.xls">
                        </div>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-info" id="upload-excel-btn">
                            <i class="bi bi-upload"></i> 엑셀 데이터 업로드
                        </button>
                            <button type="button" class="btn btn-outline-secondary" id="download-template-btn">
                            <i class="bi bi-download"></i> 템플릿 다운로드
                        </button>
                    </div>
                        <div class="mt-3 text-muted">
                            <small>
                                <strong>엑셀 파일 형식:</strong><br>
                                • <strong>고객정보 시트:</strong> 이름, 성별, 전화번호, 생년월일, 주소, 주방문매장, 이메일, 메모<br>
                                • <strong>구매이력 시트:</strong> 고객전화번호, 구매일, 상품명, <strong>가격</strong>, 주문장번호, 구매매장, 담당셀러, 결제방법, 메모<br>
                                • <strong>중요:</strong> 구매이력의 고객전화번호는 고객정보의 전화번호와 정확히 일치해야 합니다<br>
                                • <strong>가격 형식:</strong> 숫자만 입력 (예: 280000, 2800000) - 콤마나 '원' 문자는 자동 제거됩니다<br>
                                • 단일 시트는 고객정보로 처리됩니다. 템플릿 다운로드를 권장합니다.
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 생일 알림 페이지 -->
            <div id="birthday-alerts" class="page d-none">
                <h3 class="mb-3">생일 알림</h3>
                
                <div class="row">
                    <div class="col-12 col-md-6">
                        <div class="card">
                    <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="bi bi-calendar-heart text-danger"></i> 이번 달 생일
                                </h5>
                    </div>
                    <div class="card-body">
                                <div id="this-month-birthdays">
                                    <!-- 이번 달 생일 목록이 여기에 표시됩니다 -->
                    </div>
                </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                <div class="card">
                    <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="bi bi-calendar-check text-info"></i> 다음 달 생일
                                </h5>
                    </div>
                    <div class="card-body">
                                <div id="next-month-birthdays">
                                    <!-- 다음 달 생일 목록이 여기에 표시됩니다 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 선물 이력 페이지 -->
            <div id="gift-history" class="page d-none">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="mb-0">선물 이력 관리</h3>
                    <button class="btn btn-primary" id="add-gift-btn">
                        <i class="bi bi-plus-circle"></i> 선물 기록 추가
                    </button>
                </div>
                
                <!-- 검색창 -->
                <div class="mb-3">
                        <div class="input-group">
                        <input type="text" class="form-control" id="gift-search-input" placeholder="고객명으로 검색">
                        <button class="btn btn-outline-secondary" id="gift-search-btn">검색</button>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>고객명</th>
                                <th>선물 종류</th>
                                <th>선물 내용</th>
                                <th class="mobile-hide">제공 일자</th>
                                <th class="mobile-hide">제공 이유</th>
                                <th>상세</th>
                            </tr>
                        </thead>
                        <tbody id="gift-history-body">
                            <!-- 선물 이력이 여기에 동적으로 삽입됩니다 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 고객 등급 페이지 -->
            <div id="customer-ranking" class="page d-none">
                <h3 class="mb-3">고객 등급 관리</h3>
                
                <!-- 등급별 통계 카드 (한 줄 표시) -->
                <div class="row mb-4">
                    <div class="col-4">
                        <div class="card text-white bg-dark" data-grade="VVIP" style="cursor: pointer;">
                            <div class="card-body text-center">
                                <h6 class="card-title mb-2">VVIP 고객</h6>
                                <h3 class="card-text mb-0" id="vvip-count">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="card text-white bg-danger" data-grade="VIP" style="cursor: pointer;">
                            <div class="card-body text-center">
                                <h6 class="card-title mb-2">VIP 고객</h6>
                                <h3 class="card-text mb-0" id="vip-count">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="card text-white bg-primary" data-grade="일반" style="cursor: pointer;">
                            <div class="card-body text-center">
                                <h6 class="card-title mb-2">일반 고객</h6>
                                <h3 class="card-text mb-0" id="regular-count">0</h3>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 등급 기준 설명 -->
                <div class="alert alert-info">
                    <h6><i class="bi bi-info-circle"></i> 등급 기준</h6>
                    <ul class="mb-0">
                        <li><strong>VVIP</strong>: 총 구매액 2,000만원 이상</li>
                        <li><strong>VIP</strong>: 총 구매액 1,000만원 이상</li>
                        <li><strong>일반</strong>: 그 외 모든 고객</li>
                    </ul>
                </div>
                
                <!-- 검색 및 필터 -->
                <div class="row mb-3">
                    <div class="col-12 col-md-6">
                        <div class="input-group">
                            <input type="text" class="form-control" id="ranking-search-input" placeholder="고객명 검색">
                            <button class="btn btn-outline-secondary" id="ranking-search-btn">검색</button>
                        </div>
                    </div>
                    <div class="col-12 col-md-3">
                        <select class="form-select" id="grade-filter">
                            <option value="">전체 등급</option>
                                    <option value="VVIP">VVIP</option>
                                    <option value="VIP">VIP</option>
                                    <option value="일반">일반</option>
                                </select>
                            </div>
                    <div class="col-12 col-md-3">
                        <select class="form-select" id="sort-option">
                                    <option value="totalAmount-desc">구매액 높은순</option>
                                    <option value="totalAmount-asc">구매액 낮은순</option>
                                    <option value="purchaseCount-desc">구매횟수 많은순</option>
                                    <option value="purchaseCount-asc">구매횟수 적은순</option>
                                </select>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>이름</th>
                                <th>등급</th>
                                <th>총 구매액</th>
                                <th>총 구매 횟수</th>
                                <th>등급 변경 이력</th>
                            </tr>
                        </thead>
                        <tbody id="ranking-list-body">
                            <!-- 등급 목록이 여기에 동적으로 삽입됩니다 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 방문 주기 페이지 -->
            <div id="visit-tracking" class="page d-none">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="mb-0">고객 방문 주기 관리</h3>
                    <button class="btn btn-primary" id="add-visit-btn">
                        <i class="bi bi-plus-circle"></i> 방문 기록 추가
                    </button>
                </div>
                
                <!-- 검색창 -->
                <div class="mb-3">
                        <div class="input-group">
                        <input type="text" class="form-control" id="visit-search-input" placeholder="고객명으로 검색">
                        <button class="btn btn-outline-secondary" id="visit-search-btn">검색</button>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>이름</th>
                                <th>최근 방문일</th>
                                <th class="mobile-hide">평균 방문 주기(일)</th>
                                <th class="mobile-hide">방문 횟수</th>
                                <th>다음 예상 방문일</th>
                                <th>상세</th>
                            </tr>
                        </thead>
                        <tbody id="visit-tracking-body">
                            <!-- 방문 주기 목록이 여기에 동적으로 삽입됩니다 -->
                        </tbody>
                    </table>
                </div>
            </div>

            </div>
                </div>
            </div>

            <!-- 고객 상세 정보 모달 -->
            <div class="modal fade" id="customer-details-modal" tabindex="-1">
        <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">고객 상세 정보</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                    <!-- 고객 상세 정보가 여기에 로드됩니다 -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 구매 기록 추가 모달 -->
            <div class="modal fade" id="add-purchase-modal" tabindex="-1">
        <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">구매 기록 추가</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                    <!-- 구매 기록 폼이 여기에 로드됩니다 -->
                                </div>
                                    </div>
                                                    </div>
                                                    </div>

    <!-- 선물 기록 추가 모달 -->
    <div class="modal fade" id="add-gift-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">선물 기록 추가</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                </div>
                <div class="modal-body">
                    <!-- 선물 기록 폼이 여기에 로드됩니다 -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

    <!-- 방문 기록 추가 모달 -->
    <div class="modal fade" id="add-visit-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">방문 기록 추가</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                <div class="modal-body">
                    <!-- 방문 기록 폼이 여기에 로드됩니다 -->
                                    </div>
                                    </div>
                                </div>
                                </div>
                                
    <!-- 등급 변경 이력 모달 -->
    <div class="modal fade" id="rank-history-modal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">등급 변경 이력</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                <div class="modal-body">
                    <!-- 등급 변경 이력이 여기에 로드됩니다 -->
                        </div>
                    </div>
        </div>
    </div>

    <!-- 로그인 모달 -->
    <div class="modal fade" id="login-modal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">아서앤그레이스 고객관리시스템</h5>
                </div>
                <div class="modal-body">
                    <form id="login-form">
                        <div class="text-center mb-4">
                            <h4>로그인</h4>
                            <p class="text-muted">관리자 계정으로 로그인하세요</p>
                        </div>
                        <div class="mb-3">
                            <label for="login-id" class="form-label">아이디</label>
                            <input type="text" class="form-control" id="login-id" required placeholder="아이디를 입력하세요">
                        </div>
                        <div class="mb-3">
                            <label for="login-password" class="form-label">비밀번호</label>
                            <input type="password" class="form-control" id="login-password" required placeholder="비밀번호를 입력하세요">
                        </div>
                        <div id="login-error" class="alert alert-danger d-none" role="alert">
                            아이디 또는 비밀번호가 올바르지 않습니다.
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">로그인</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>
</html> 