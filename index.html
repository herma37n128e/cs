<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>아서앤그레이스 고객관리 시스템</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="complete-fix.js"></script>
</head>
<body>
    <div class="container">
        <header class="my-4">
            <h1 class="text-center">아서앤그레이스</h1>
            <h2 class="text-center">고객관리 시스템</h2>
        </header>

        <div id="login-form" class="card p-4 mx-auto" style="max-width: 500px;">
            <h3 class="text-center mb-4">로그인</h3>
            <form id="login">
                <div class="mb-3">
                    <label for="password" class="form-label">비밀번호</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary w-100">로그인</button>
            </form>
        </div>

        <div id="main-content" class="d-none">
            <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
                <div class="container-fluid">
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link active" href="#" data-page="customer-list">고객 목록</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-page="add-customer">고객 등록</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-page="birthday-alerts">생일 알림</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-page="gift-history">선물 이력</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-page="customer-ranking">고객 등급</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-page="visit-tracking">방문 주기</a>
                            </li>
                        </ul>
                        <ul class="navbar-nav ms-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="#" id="logout-btn">로그아웃</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>

            <!-- 고객 목록 페이지 -->
            <div id="customer-list" class="page">
                <h3 class="mb-3">고객 목록</h3>
                <div class="row mb-3">
                    <div class="col">
                        <div class="input-group">
                            <input type="text" class="form-control" id="search-input" placeholder="이름, 전화번호, 매장, 등급, 메모로 검색">
                            <button class="btn btn-primary" id="search-btn">검색</button>
                        </div>
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-success" id="export-excel-btn">
                            <i class="bi bi-download"></i> 엑셀 다운로드
                        </button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th class="sortable" data-sort="name">
                                    이름 <i class="bi bi-arrow-down-up sort-icon"></i>
                                </th>
                                <th>전화번호</th>
                                <th class="mobile-hide sortable" data-sort="birthdate">
                                    생년월일 <i class="bi bi-arrow-down-up sort-icon"></i>
                                </th>
                                <th class="mobile-hide sortable" data-sort="preferredStore">
                                    주방문매장 <i class="bi bi-arrow-down-up sort-icon"></i>
                                </th>
                                <th class="sortable" data-sort="rank">
                                    등급 <i class="bi bi-arrow-down-up sort-icon"></i>
                                </th>
                                <th class="mobile-hide sortable" data-sort="lastVisit">
                                    최근 방문일 <i class="bi bi-arrow-down-up sort-icon"></i>
                                </th>
                                <th>상세</th>
                            </tr>
                        </thead>
                        <tbody id="customer-list-body">
                            <!-- 고객 목록이 여기에 동적으로 삽입됩니다 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 모바일 전용 하단 버튼 -->
                <div class="mobile-fixed-bottom d-md-none">
                    <button class="btn btn-success" id="mobile-add-customer-btn">
                        <i class="bi bi-plus-circle"></i> 고객 등록
                    </button>
                </div>
            </div>

            <!-- 고객 등록 페이지 -->
            <div id="add-customer" class="page d-none">
                <h3 class="mb-3">고객 등록</h3>
                
                <!-- 엑셀 업로드 섹션 -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">엑셀 파일 업로드</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="excel-file" class="form-label">엑셀 파일 선택 (.xlsx, .xls)</label>
                            <input type="file" class="form-control" id="excel-file" accept=".xlsx,.xls">
                        </div>
                        <button type="button" class="btn btn-success" id="upload-excel-btn">
                            <i class="bi bi-upload"></i> 엑셀 데이터 업로드
                        </button>
                        <button type="button" class="btn btn-info ms-2" id="download-template-btn">
                            <i class="bi bi-download"></i> 템플릿 다운로드
                        </button>
                        <div class="mt-3">
                            <small class="text-muted">
                                <strong>엑셀 파일 형식:</strong><br>
                                • <strong>고객정보 시트:</strong> 이름, 성별, 전화번호, 생년월일, 주소, 주방문매장, 이메일, 메모<br>
                                • <strong>구매이력 시트:</strong> 고객전화번호, 구매일, 상품명, <strong style="color:red;">가격</strong>, 주문장번호, 구매매장, 담당셀러, 결제방법, 메모<br>
                                • <strong style="color:blue;">중요:</strong> 구매이력의 고객전화번호는 고객정보의 전화번호와 정확히 일치해야 합니다<br>
                                • <strong style="color:blue;">가격 형식:</strong> 숫자만 입력 (예: 280000, 2800000) - 콤마나 '원' 문자는 자동 제거됩니다<br>
                                • 단일 시트는 고객정보로 처리됩니다. 템플릿 다운로드를 권장합니다.
                            </small>
                        </div>
                    </div>
                </div>

                <hr class="my-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">개별 고객 등록</h5>
                    </div>
                    <div class="card-body">
                        <form id="customer-form">
                            <div class="row">
                                <div class="col-12 col-md-6">
                                    <div class="mb-3">
                                        <label for="name" class="form-label">이름 *</label>
                                        <input type="text" class="form-control" id="name" required placeholder="고객 이름을 입력하세요">
                                    </div>
                                    <div class="mb-3">
                                        <label for="phone" class="form-label">전화번호 *</label>
                                        <input type="tel" class="form-control" id="phone" required placeholder="010-0000-0000">
                                    </div>
                                    <div class="mb-3">
                                        <label for="gender" class="form-label">성별</label>
                                        <select class="form-select" id="gender">
                                            <option value="">선택 안함</option>
                                            <option value="male">남성</option>
                                            <option value="female">여성</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="birthdate" class="form-label">생년월일</label>
                                        <input type="date" class="form-control" id="birthdate">
                                    </div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <div class="mb-3">
                                        <label for="address" class="form-label">주소</label>
                                        <input type="text" class="form-control" id="address" placeholder="주소를 입력하세요">
                                    </div>
                                    <div class="mb-3">
                                        <label for="preferred-store" class="form-label">주방문매장</label>
                                        <input type="text" class="form-control" id="preferred-store" placeholder="주로 방문하는 매장">
                                    </div>
                                    <div class="mb-3">
                                        <label for="email" class="form-label">이메일</label>
                                        <input type="email" class="form-control" id="email" placeholder="example@email.com">
                                    </div>
                                    <div class="mb-3">
                                        <label for="notes" class="form-label">메모</label>
                                        <textarea class="form-control" id="notes" rows="3" placeholder="고객에 대한 추가 정보나 메모"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="d-grid d-md-block">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="bi bi-person-plus"></i> 고객 등록
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- 생일 알림 페이지 -->
            <div id="birthday-alerts" class="page d-none">
                <h3 class="mb-3">생일 알림</h3>
                <div class="card mb-3">
                    <div class="card-header">
                        이번 달 생일
                    </div>
                    <div class="card-body">
                        <ul id="this-month-birthdays" class="list-group">
                            <!-- 이번 달 생일 고객 목록이 여기에 동적으로 삽입됩니다 -->
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        다음 달 생일
                    </div>
                    <div class="card-body">
                        <ul id="next-month-birthdays" class="list-group">
                            <!-- 다음 달 생일 고객 목록이 여기에 동적으로 삽입됩니다 -->
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 선물 이력 페이지 -->
            <div id="gift-history" class="page d-none">
                <h3 class="mb-3">선물 이력 관리</h3>
                <div class="row mb-3">
                    <div class="col">
                        <div class="input-group">
                            <input type="text" class="form-control" id="gift-search" placeholder="고객 이름으로 검색">
                            <button class="btn btn-primary" id="gift-search-btn">검색</button>
                        </div>
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-success" id="add-gift-btn">+ 선물 기록 추가</button>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>고객명</th>
                                <th>선물 종류</th>
                                <th>선물 내용</th>
                                <th>제공 일자</th>
                                <th>제공 이유</th>
                                <th>상세</th>
                            </tr>
                        </thead>
                        <tbody id="gift-history-body">
                            <!-- 선물 이력이 여기에 동적으로 삽입됩니다 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 고객 등급 페이지 -->
            <div id="customer-ranking" class="page d-none">
                <h3 class="mb-3">고객 등급 관리</h3>
                <div class="row row-cols-1 row-cols-md-3 mb-4 g-4">
                    <div class="col">
                        <div class="card h-100 text-white bg-danger">
                            <div class="card-body">
                                <h5 class="card-title">VVIP 고객</h5>
                                <p id="vvip-count" class="card-text display-4">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card h-100 text-white bg-primary">
                            <div class="card-body">
                                <h5 class="card-title">VIP 고객</h5>
                                <p id="vip-count" class="card-text display-4">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card h-100 text-white bg-secondary">
                            <div class="card-body">
                                <h5 class="card-title">일반 고객</h5>
                                <p id="regular-count" class="card-text display-4">0</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <h4>등급 기준</h4>
                    <ul>
                        <li><strong>VVIP</strong>: 총 구매액 2,000만원 이상</li>
                        <li><strong>VIP</strong>: 총 구매액 1,000만원 이상</li>
                        <li><strong>일반</strong>: 그 외 모든 고객</li>
                    </ul>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>이름</th>
                                <th>등급</th>
                                <th>총 구매액</th>
                                <th>총 구매 횟수</th>
                                <th>등급 변경 이력</th>
                            </tr>
                        </thead>
                        <tbody id="ranking-list-body">
                            <!-- 고객 등급 목록이 여기에 동적으로 삽입됩니다 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 방문 주기 페이지 -->
            <div id="visit-tracking" class="page d-none">
                <h3 class="mb-3">고객 방문 주기 관리</h3>
                <div class="row mb-3">
                    <div class="col">
                        <div class="input-group">
                            <input type="text" class="form-control" id="visit-search" placeholder="고객 이름으로 검색">
                            <button class="btn btn-primary" id="visit-search-btn">검색</button>
                        </div>
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-success" id="add-visit-btn">+ 방문 기록 추가</button>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>이름</th>
                                <th>최근 방문일</th>
                                <th>평균 방문 주기(일)</th>
                                <th>방문 횟수</th>
                                <th>다음 예상 방문일</th>
                                <th>상세</th>
                            </tr>
                        </thead>
                        <tbody id="visit-list-body">
                            <!-- 방문 주기 목록이 여기에 동적으로 삽입됩니다 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 고객 상세 정보 모달 -->
            <div class="modal fade" id="customer-details-modal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">고객 상세 정보</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <ul class="nav nav-tabs" id="customerTabs">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#info-tab">기본 정보</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#purchase-tab">구매 이력</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#gift-tab">선물 이력</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#visit-tab">방문 이력</a>
                                </li>
                            </ul>
                            <div class="tab-content mt-3">
                                <div class="tab-pane fade show active" id="info-tab">
                                    <div id="customer-info-content">
                                        <!-- 고객 기본 정보가 여기에 삽입됩니다 -->
                                    </div>
                                    <div class="mt-3">
                                        <button id="edit-customer-btn" class="btn btn-primary">수정</button>
                                        <button id="delete-customer-btn" class="btn btn-danger">삭제</button>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="purchase-tab">
                                    <div id="purchase-history-content">
                                        <!-- 구매 이력이 여기에 삽입됩니다 -->
                                    </div>
                                    <div class="mt-3">
                                        <button id="add-purchase-btn" class="btn btn-success">+ 구매 기록 추가</button>
                                        <button id="download-purchase-pdf" class="btn btn-info">PDF 다운로드</button>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="gift-tab">
                                    <div id="gift-history-content">
                                        <!-- 선물 이력이 여기에 삽입됩니다 -->
                                    </div>
                                    <div class="mt-3">
                                        <button id="add-customer-gift-btn" class="btn btn-success">+ 선물 기록 추가</button>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="visit-tab">
                                    <div id="visit-history-content">
                                        <!-- 방문 이력이 여기에 삽입됩니다 -->
                                    </div>
                                    <div class="mt-3">
                                        <button id="add-customer-visit-btn" class="btn btn-success">+ 방문 기록 추가</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 구매 기록 추가 모달 -->
            <div class="modal fade" id="add-purchase-modal" tabindex="-1">
                <div class="modal-dialog modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">구매 기록 추가</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="add-purchase-form">
                                <input type="hidden" id="purchase-customer-id">
                                
                                <div class="mb-3">
                                    <label for="purchase-date" class="form-label">구매일 *</label>
                                    <input type="date" class="form-control" id="purchase-date" required>
                                </div>
                                
                                <div class="card mb-3">
                                    <div class="card-header">
                                        <small class="text-muted">구매 상품 정보</small>
                                    </div>
                                    <div class="card-body">
                                        <div id="purchase-items">
                                            <div class="purchase-item mb-3">
                                                <div class="row g-2">
                                                    <div class="col-12 col-md-7">
                                                        <label class="form-label">상품명 *</label>
                                                        <input type="text" class="form-control item-name" required placeholder="구매하신 상품명을 입력하세요">
                                                    </div>
                                                    <div class="col-12 col-md-5">
                                                        <label class="form-label">가격 *</label>
                                                        <input type="number" class="form-control item-price" required placeholder="0">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="d-grid">
                                            <button type="button" class="btn btn-outline-secondary" id="add-item-btn">
                                                <i class="bi bi-plus-circle"></i> 상품 추가
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="purchase-order-number" class="form-label">주문장번호</label>
                                    <input type="text" class="form-control" id="purchase-order-number" placeholder="주문장번호 (선택사항)">
                                </div>
                                
                                <div class="row g-2 mb-3">
                                    <div class="col-12 col-md-6">
                                        <label for="purchase-store" class="form-label">구매매장</label>
                                        <input type="text" class="form-control" id="purchase-store" placeholder="구매한 매장명">
                                    </div>
                                    <div class="col-12 col-md-6">
                                        <label for="purchase-staff" class="form-label">담당셀러</label>
                                        <input type="text" class="form-control" id="purchase-staff" placeholder="담당 직원명">
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="payment-method" class="form-label">결제 방법 *</label>
                                    <select class="form-select" id="payment-method" required>
                                        <option value="">결제 방법을 선택하세요</option>
                                        <option value="신용카드">신용카드</option>
                                        <option value="현금">현금</option>
                                        <option value="계좌이체">계좌이체</option>
                                        <option value="기타">기타</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="purchase-memo" class="form-label">메모</label>
                                    <textarea class="form-control" id="purchase-memo" rows="3" placeholder="추가 메모사항 (선택사항)"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                            <button type="submit" form="add-purchase-form" class="btn btn-primary">
                                <i class="bi bi-check-circle"></i> 저장
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 선물 기록 추가 모달 -->
            <div class="modal fade" id="add-gift-modal" tabindex="-1">
                <div class="modal-dialog modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">선물 기록 추가</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="add-gift-form">
                                <input type="hidden" id="gift-customer-id">
                                
                                <div class="mb-3">
                                    <label for="gift-type" class="form-label">선물 종류 *</label>
                                    <select class="form-select" id="gift-type" required>
                                        <option value="">선물 종류를 선택하세요</option>
                                        <option value="생일선물">생일선물</option>
                                        <option value="연말선물">연말선물</option>
                                        <option value="감사선물">감사선물</option>
                                        <option value="기타">기타</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="gift-description" class="form-label">선물 내용 *</label>
                                    <input type="text" class="form-control" id="gift-description" required placeholder="제공한 선물의 구체적인 내용을 입력하세요">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="gift-date" class="form-label">제공일 *</label>
                                    <input type="date" class="form-control" id="gift-date" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="gift-reason" class="form-label">제공 이유 *</label>
                                    <input type="text" class="form-control" id="gift-reason" required placeholder="선물을 제공한 이유나 계기를 입력하세요">
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                            <button type="submit" form="add-gift-form" class="btn btn-primary">
                                <i class="bi bi-gift"></i> 저장
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 방문 기록 추가 모달 -->
            <div class="modal fade" id="add-visit-modal" tabindex="-1">
                <div class="modal-dialog modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">방문 기록 추가</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="add-visit-form">
                                <input type="hidden" id="visit-customer-id">
                                
                                <div class="mb-3">
                                    <label for="visit-date" class="form-label">방문일 *</label>
                                    <input type="date" class="form-control" id="visit-date" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="visit-purpose" class="form-label">방문 목적 *</label>
                                    <input type="text" class="form-control" id="visit-purpose" required placeholder="방문 목적을 입력하세요 (예: 상담, 구매, 문의 등)">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="visit-note" class="form-label">메모</label>
                                    <textarea class="form-control" id="visit-note" rows="3" placeholder="방문 관련 추가 메모사항 (선택사항)"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                            <button type="submit" form="add-visit-form" class="btn btn-primary">
                                <i class="bi bi-calendar-check"></i> 저장
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html> 